extends layout

block content
  script.
    $(document).ready(function() {

      // update score
      $("#scoreCourant").html($("#scoreCourant").html() + (Math.round(parseInt(localStorage.score) / parseInt(localStorage.count) * 100) || 0) + "%");

      // get new question
      $.get('/ajax/test', {}, function(result) {
        // save data to localStorage
        localStorage.question = JSON.stringify(result);
        localStorage.count = parseInt(localStorage.count) + 1;
        localStorage.domain = result.domain;

        // update view
        $("#questionText").html(result.question);
        $("#domain").html("Domaine : " + localStorage.domain.toUpperCase());

        var i;
        for(i = 0; i < result.ans.length; i++) {
          $("#next").before("<input id='ans"+i+"' type='radio' name='q"+localStorage.count+"' value='"+result.ans[i].value+"' />" +
          "<label for='ans"+i+"'>" + result.ans[i].text + "</label><br>");
        }

      });

      $("#test").submit(function( event ) {
        var correctAnswer = JSON.parse(localStorage.question).trueAnswer;
        var attemptedAnswer = $('input[name=q'+localStorage.count+']:checked', '#test').val();
        if(correctAnswer == attemptedAnswer) {
          localStorage.score = parseInt(localStorage.score) + 1;
        }
      });
    });
  section#question.leftSideBlock
    h1#questionTitle #{title}
    div
      form#test(method='post', action='./test')
        p#domain Domaine :
        h2#questionText #{title}
        input#next(type='submit', name='submit', value='Prochaine question')
      form(method='get', action='./tableau')
        input(type='submit', value='Retour')
  section#tableaux
    h1 Statistiques
    div
      table#generalstats.statistiques
        caption Statistiques g&eacute;n&eacute;rales
        tr
            th Nb tests reussis / effectues
            th Moyenne examens
        tr
            td 1 / 99
            td 71%
    #statistics
      p#scoreCourant Score courant :&nbsp;
